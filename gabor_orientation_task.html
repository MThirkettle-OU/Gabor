
<!DOCTYPE html>
<html>
<head>
    <title>Gabor Orientation Task</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        canvas { margin: 10px; }
        #feedback { font-size: 20px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Gabor Orientation Task</h1>
    <p>Press 1, 2, or 3 to choose the Gabor patch with a different orientation.</p>
    <div id="stimuli"></div>
    <div id="feedback"></div>
    <script>
        const canvasSize = 100;
        const frequency = 0.1;
        const trials = 10;
        let currentTrial = 0;
        let correctIndex = 0;

        function generateGabor(canvas, orientation) {
            const ctx = canvas.getContext("2d");
            const imageData = ctx.createImageData(canvasSize, canvasSize);
            for (let y = 0; y < canvasSize; y++) {
                for (let x = 0; x < canvasSize; x++) {
                    const dx = x - canvasSize / 2;
                    const dy = y - canvasSize / 2;
                    const theta = orientation * Math.PI / 180;
                    const xr = dx * Math.cos(theta) + dy * Math.sin(theta);
                    const value = Math.sin(2 * Math.PI * frequency * xr);
                    const color = Math.round((value + 1) * 127.5);
                    const index = (y * canvasSize + x) * 4;
                    imageData.data[index] = color;
                    imageData.data[index + 1] = color;
                    imageData.data[index + 2] = color;
                    imageData.data[index + 3] = 255;
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }

        function showTrial() {
            document.getElementById("stimuli").innerHTML = "";
            document.getElementById("feedback").innerText = "";
            const baseOrientation = Math.floor(Math.random() * 180);
            const oddOrientation = baseOrientation + 30;
            correctIndex = Math.floor(Math.random() * 3);
            for (let i = 0; i < 3; i++) {
                const canvas = document.createElement("canvas");
                canvas.width = canvasSize;
                canvas.height = canvasSize;
                const orientation = (i === correctIndex) ? oddOrientation : baseOrientation;
                generateGabor(canvas, orientation);
                document.getElementById("stimuli").appendChild(canvas);
            }
        }

        document.addEventListener("keydown", function(event) {
            if (event.key >= "1" && event.key <= "3") {
                const response = parseInt(event.key) - 1;
                const feedback = (response === correctIndex) ? "Correct!" : "Incorrect.";
                document.getElementById("feedback").innerText = feedback;
                setTimeout(() => {
                    currentTrial++;
                    if (currentTrial < trials) {
                        showTrial();
                    } else {
                        document.getElementById("stimuli").innerHTML = "";
                        document.getElementById("feedback").innerText = "Task complete. Thank you!";
                    }
                }, 1000);
            }
        });

        showTrial();
    </script>
</body>
</html>
